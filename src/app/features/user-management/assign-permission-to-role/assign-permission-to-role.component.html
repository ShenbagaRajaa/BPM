<div [class]="cssStyle">
  <!-- Navigation Bar Component with conditional rendering based on 'child' variable -->
  <app-navigationbar
    *ngIf="!child"
    pageTitle="Role Permissions"
    [button]="hasPermissionToViewPermision"
    buttonLabel="VIEW PERMISSIONS"
    (activeValue)="permissionManagement()"
  ></app-navigationbar>
  <!-- Main content container for Role Permissions -->
  <div
    class="w-full bg-white tablet:bg-white md:bg-white shadow-lg p-4 flex-grow pb-32"
  >
    <div class="w-full md:w-1/2 mb-4" *ngIf="!child">
      <app-searchable-dropdown
        label="Select Role"
        [options]="roles"
        blankMsg="role"
        [value]="roleId"
        (activeValue)="getRole($event)"
      ></app-searchable-dropdown>
    </div>

    <form>
      <div class="space-y-6">
        <!-- Permission Groups -->
        <fieldset
          *ngFor="let group of groupedPermissions"
          class="p-4 rounded-lg border border-text shadow-sm"
        >
          <!-- Group Header -->
          <legend class="text-lg font-medium text-text mb-3 px-2">
            {{ group.name }}
          </legend>

          <!-- Permissions Grid -->
          <div
            class="grid grid-cols-2 tablet:grid-cols-3 md:grid-cols-3 lg:grid-cols-3 gap-4"
          >
            <div
              *ngFor="let permission of group.permissions"
              class="checkbox-container"
            >
              <mat-checkbox
                [(ngModel)]="
                  selectedPermissions[getPermissionIndex(permission)]
                "
                [name]="'permission' + permission.id"
                (change)="onPermissionChange()"
                class="text-sm"
              >
                {{
                  permission.permissionName.split("/")[1] ||
                    permission.permissionName
                }}
              </mat-checkbox>
            </div>
          </div>
        </fieldset>
      </div>

      <!-- Action Buttons -->
      <div
        class="flex flex-row md:col-span-3 mt-6 mb-16 tablet:mb-16"
        *ngIf="!child"
      >
        <div class="flex-1"></div>
        <div class="items-center justify-end">
          <button
            class="mat-raised-button-cancel mr-4 text-toolbarBg bg-text px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
            mat-raised-button
            (click)="back()"
          >
            CANCEL
          </button>
          <button
            class="mat-raised-button text-toolbarBg bg-text px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
            mat-raised-button
            (click)="savePermissions()"
            [disabled]="saveButtonDisabled"
          >
            SAVE
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
